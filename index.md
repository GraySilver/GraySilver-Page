### 机器学习：生动理解基于图模型的推荐算法——PersonalRank

[TOC]

#### 用户行为数据的二分图表示
用户行为很容易用二分图表示，所以很多图的算法都可以用到推荐系统中。基于图的模型（graph-based model）是推荐系统中的重要内容。在研究基于图的模型之前，首先需要将用户行为数据表示成图的形式。文章中讨论的用户行为数据是由一系列二元组组成的，其中每个二元组(u, i)表示用户u对物品i产生过行为。这种数据集很容易用一个二分图表示。
下图是一个简单的用户物品二分图模型，其中圆形节点代表用户，方形节点代表物品，圆形节点和方形节点之间的边代表用户对物品的行为。比如图中用户节点A和物品节点a、 b、 d相连，说明用户A对物品a、 b、 d产生过行为。

![Alt text](https://github.com/GraySilver/article/raw/master/pic/personalrank/1.png)

#### 基于图推荐算法的一般思路
将用户行为表示为二分图模型后，下面的任务就是在二分图上给用户进行个性化推荐。如果将个性化推荐算法放到二分图模型上，那么给用户u推荐物品的任务就可以转化为度量用户顶点vu和与vu没有边直接相连的物品节点在图上的相关性，相关性越高的物品在推荐列表中的权重就越高。
度量图中两个顶点之间相关性的方法很多，但一般来说图中顶点的相关性主要取决于下面3个因素：
- 两个顶点之间的路径数；
- 两个顶点之间路径的长度；
- 两个顶点之间的路径经过的顶点。

而相关性高的一对顶点一般具有如下特征：
- 两个顶点之间有很多路径相连；
- 连接两个顶点之间的路径长度都比较短；
- 连接两个顶点之间的路径不会经过出度比较大的顶点。

#### 基于随机游走的PersonalRank算法
如下图所示，用户A和物品c、 e没有边相连，但是用户A和物品c有两条长度为3的路径相连，用户A和物品e有两条长度为3的路径相连。那么，顶点A与e之间的相关性要高于顶点A与c，因而物品e在用户A的推荐列表中应该排在物品c之前，因为顶点A与e之间有两条路径——(A, b, C, e)和(A, d, D, e) 。其中，(A, b, C, e)路径经过的顶点的出度为(3, 2, 2, 2) ，而(A, d, D, e)路径经过的顶点的出度为(3, 2, 3, 2) 。因此，(A, d, D, e)经过了一个出度比较大的顶点D，所以(A, d, D, e)对顶点A与e之间相关性的贡献要小于(A, b, C, e) 。简而言之就是求A到e和A到c在线相连的长度谁更短，且是否经过热门中转点来计算权重求得两者的相关性大小。

![Alt text](https://github.com/GraySilver/article/raw/master/pic/personalrank/2.png)

有种基于随机游走的PersonalRank算法可以计算图中顶点之间相关性的方法，假设要给用户u进行个性化推荐，可以从用户u对应的节点vu开始在用户物品二分图上进行随机游走。游走到任何一个节点时，首先按照概率α决定是继续游走，还是停止这次游走并从vu节点开始重新游走。
如果决定继续游走，那么就从当前节点指向的节点中按照均匀分布随机选择一个节点作为游走下次经过的节点。这样，经过很多次随机游走后，每个物品节点被访问到的概率会收敛到一个数。最终的推荐列表中物品的权重就是物品节点的访问概率。
如果将上面的描述表示成公式，可以得到如下公式：
![Alt text](https://github.com/GraySilver/article/raw/master/pic/personalrank/3.png)

#### 一个简单的例子

![Alt text](https://github.com/GraySilver/article/raw/master/pic/personalrank/4.png)

上图是一个PersonalRank的例子，在这个例子中，用户A没有对物品b、 d有过行为。在最后的迭代结果中， d的访问概率大于b，因此给A的推荐列表就是{d, b}。下图同时给出了不同迭代次数后每个顶点的访问概率。从图中可以看到，每个顶点的访问概率在9次迭代之后就基本上收敛了。

![Alt text](https://github.com/GraySilver/article/raw/master/pic/personalrank/5.png)

#### 总结
虽然PersonalRank算法可以通过随机游走进行比较好的理论解释，但该算法在时间复杂度上有明显的缺点。因为在为每个用户进行推荐时，都需要在整个用户物品二分图上进行迭代，直到整个图上的每个顶点的PR值收敛。这一过程的时间复杂度非常高，不仅无法在线提供实时推荐，甚至离线生成推荐结果也很耗时，所以PersonalRank比较适合离线计算进行备份推荐使用。

